<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ ç¾¤éªŒè¯</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="groupinvite.css">
    <script>
        // åœ¨é¡µé¢æ¸²æŸ“å‰åº”ç”¨ä¸»é¢˜ï¼Œé¿å…é—ªçƒ
        (function() {
            const theme = localStorage.getItem('theme-preference') || 'system';
            let isDark = false;
            
            if (theme === 'system') {
                isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            } else if (theme === 'dark') {
                isDark = true;
            }
            
            if (isDark) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
</head>
<body>
    <inbody>
        <div class="quiz-container">
            <h1>åŠ ç¾¤éªŒè¯</h1>
            <p class="quiz-intro">æƒ³è¦åŠ å…¥ç¾¤èŠï¼Œéœ€è¦æ»¡åˆ†é€šè¿‡å››å¤§å…³ã€‚</p>
            <p class="quiz-stages">1.æ™ºåŠ› 2.æƒ…å•† 3.å­¦å† 4.å¸¸è¯†</p>
            <p class="quiz-tip">æç¤ºï¼šå­¦å†å…³ä½ å¯ä»¥ä½¿ç”¨AIä½œå¼Šï¼Œå…¶ä»–å…³å¡è¿˜éœ€è¦è¾…åŠ©çš„å¯ä»¥æ‰¾ä¸ªæ¥¼è·³äº†ã€‚</p>
            
            <div id="quiz-start" class="quiz-start">
                <button id="start-btn" class="btn-start">å¼€å§‹éªŒè¯</button>
            </div>

            <div id="quiz-content" class="quiz-content" style="display: none;">
                <div id="stage-header" class="stage-header"></div>
                <div id="error-message" class="error-message" style="display: none;"></div>
                
                <form id="quiz-form">
                    <div id="questions-container"></div>

                    <div class="quiz-buttons">
                        <button type="button" id="prev-stage-btn" class="btn-nav" style="display: none;">ä¸Šä¸€å…³</button>
                        <button type="button" id="next-stage-btn" class="btn-nav" style="display: none;">ä¸‹ä¸€å…³</button>
                        <button type="submit" id="submit-btn" class="btn-submit" style="display: none;">æäº¤ç­”å·</button>
                    </div>
                </form>

                <div id="result" class="result-container" style="display: none;">
                    <h2 id="result-title"></h2>
                    <p id="result-message"></p>
                    <button id="next-to-groups-btn" class="btn-start" style="display: none; margin-top: 20px;">ä¸‹ä¸€æ­¥</button>
                    <button id="retry-btn" class="btn-start" style="display: none; margin-top: 10px;">å†æ¬¡æŒ‘æˆ˜</button>
                </div>

                <div id="groups-container" class="groups-container" style="display: none;">
                    <div class="groups-header">
                        <h2>ç¾¤èŠåˆ—è¡¨</h2>
                    </div>
                    <div class="groups-list">
                        <div class="group-card">                            <img src="http://p.qlogo.cn/gh/849727851/849727851/100/" alt="MCDç¾¤" class="group-avatar">                            <div class="group-name">MCD</div>
                            <div class="group-description">æ˜é¢ä¸Šæ˜¯MCç¾¤ï¼Œä½†èŠä»€ä¹ˆéƒ½å¯ä»¥</div>
                            <div class="group-arrow">â†’</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </inbody>

    <footer></footer>

    <!-- ç¾¤è§„å¼¹çª— -->
    <div id="group-rules-modal" class="modal" style="display: none;">
        <div class="modal-content rules-modal-content">
            <h3>ç¾¤è§„</h3>
            <div class="rules-text">
                <p>1. éµå®ˆå›½å®¶æ³•å¾‹æ³•è§„</p>
                <p>2. ç¦æ­¢å¹¿å‘Šå’Œåƒåœ¾ä¿¡æ¯</p>
                <p>3. å°Šé‡ä»–äººï¼Œæ–‡æ˜èŠå¤©</p>
                <p>4. ä¸è®¨è®ºæ•æ„Ÿæ”¿æ²»è¯é¢˜</p>
                <p>5. ç¦æ­¢éªšæ‰°å’Œäººèº«æ”»å‡»</p>
                <p>6. ç¾¤ä¸»æœ‰æœ€ç»ˆè§£é‡Šæƒ</p>
                <p>7. è¿›ç¾¤ååœ¨ç¾¤å…¬å‘ŠæŸ¥çœ‹è¯¦ç»†ç¾¤è§„</p>
            </div>
            <p class="rules-countdown" id="rules-countdown"></p>
            <button id="confirm-rules-btn" class="btn-confirm">æˆ‘å·²é˜…è¯»ï¼ŒåŒæ„</button>
        </div>
    </div>

    <!-- ç¾¤å·å¼¹çª— -->
    <div id="group-number-modal" class="modal" style="display: none;">
        <div class="modal-content number-modal-content">
            <img src="http://p.qlogo.cn/gh/849727851/849727851/100/" alt="MCDç¾¤" class="modal-avatar">
            <h3>MCD ç¾¤èŠä¿¡æ¯</h3>
            <div class="group-info">
                <p>ç¾¤å·ï¼š</p>
                <div class="group-number">849727851</div>
            </div>
            <div class="modal-buttons">
                <button class="btn-ok">OK</button>
                <button class="btn-qq">æ‹‰èµ·QQ</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // åè°ƒè¯•
        (function() {
            // æ£€æŸ¥æ˜¯å¦æœ‰debug cookieï¼Œå¦‚æœæœ‰åˆ™è·³è¿‡åè°ƒè¯•
            const debugCookie = document.cookie.split(';').some(cookie => cookie.trim().startsWith('debug='));
            if (debugCookie) return;
            
            let devtools = { open: false };
            const threshold = 160;
            
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > threshold ||
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        handleDevtoolsOpen();
                    }
                } else {
                    if (devtools.open) {
                        devtools.open = false;
                        handleDevtoolsClosed();
                    }
                }
            }, 500);
            
            function handleDevtoolsOpen() {
                document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-size: 24px; color: red; text-align: center;"><div>æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·å·²æ‰“å¼€<br>è¯·å…³é—­å¼€å‘è€…å·¥å…·åé‡è¯•</div></div>';
                document.body.style.backgroundColor = '#fff';
                throw new Error('Devtools opened!');
            }
            
            function handleDevtoolsClosed() {
                location.reload();
            }
            
            // å³é”®èœå•å’Œå¿«æ·é”®ä¹Ÿåªåœ¨æ²¡æœ‰debug cookieæ—¶æ‰ç¦ç”¨
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C'))) {
                    e.preventDefault();
                    return false;
                }
            });
        })();

        // è¾…åŠ©å‡½æ•°
        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // æµ‹éªŒé€»è¾‘
        class QuizManager {
            constructor() {
                this.currentStage = 0;
                this.stages = [
                    {
                        name: 'æ™ºåŠ›',
                        description: 'æœ¬å…³è€ƒéªŒä½ çš„é€»è¾‘æ€ç»´èƒ½åŠ›',
                        questions: [
                            {
                                id: 'q1',
                                text: 'ä¸€ä¸ªäººä»ä¸€ä¸ª50ç±³é«˜çš„å¤§å¦ä¸Šè·³ä¸‹æ¥ï¼Œä¸ºä»€ä¹ˆæ²¡æ­»ï¼Ÿ',
                                options: [
                                    { text: 'å› ä¸ºä»–ç«™åœ¨ä¸€æ¥¼çš„çª—å£ä¸Š', answer: true },
                                    { text: 'å› ä¸ºä»–æœ‰é™è½ä¼', answer: false },
                                    { text: 'å› ä¸ºä»–æ˜¯è¶…äºº', answer: false },
                                    { text: 'å› ä¸ºä»–å¾ˆå¹¸è¿', answer: false }
                                ]
                            },
                            {
                                id: 'q2',
                                text: 'é©¾é©¶å‘˜çš„è€å©†æ˜¯è°ï¼Ÿ',
                                options: [
                                    { text: 'ä¿å§†', answer: false },
                                    { text: 'å¸æœºçš„å¦»å­', answer: true },
                                    { text: 'æŠ¤å£«', answer: false },
                                    { text: 'åŒ»ç”Ÿçš„å¥³å‹', answer: false }
                                ]
                            },
                            {
                                id: 'q3',
                                text: 'ä»€ä¹ˆä¸œè¥¿è¶Šæ´—è¶Šè„ï¼Ÿ',
                                options: [
                                    { text: 'è¡£æœ', answer: false },
                                    { text: 'æ°´', answer: true },
                                    { text: 'æ‰‹', answer: false },
                                    { text: 'åœ°æ¿', answer: false }
                                ]
                            },
                            {
                                id: 'q4',
                                text: 'æœ‰2ä¸ªæ¯’è¯å’Œ2ä¸ªè§£è¯ä½ å¿…é¡»åƒå®Œï¼Œé¡ºåºå¦‚ä½•ï¼Ÿ',
                                options: [
                                    { text: 'æ¯’ã€æ¯’ã€è§£ã€è§£', answer: true },
                                    { text: 'è§£ã€æ¯’ã€è§£ã€æ¯’', answer: false },
                                    { text: 'æ¯’ã€è§£ã€æ¯’ã€è§£', answer: true },
                                    { text: 'è§£ã€è§£ã€æ¯’ã€æ¯’', answer: false }
                                ]
                            }
                        ]
                    },
                    {
                        name: 'æƒ…å•†',
                        description: 'æœ¬å…³è€ƒéªŒä½ çš„ç¤¾äº¤å’Œæƒ…æ„Ÿç†è§£èƒ½åŠ›',
                        questions: [
                            {
                                id: 'q5',
                                text: 'ç¾¤é‡Œæœ‰äººåµèµ·æ¥ï¼Œä½ ä¸èƒ½ï¼Ÿ',
                                options: [
                                    { text: 'æ‰¾ç®¡ç†', answer: false },
                                    { text: 'æŒ‡è´£', answer: true },
                                    { text: 'å›´è§‚', answer: false },
                                    { text: 'è¯´ç†', answer: false }
                                ]
                            },
                            {
                                id: 'q6',
                                text: 'å’Œåˆ«äººæ„è§ä¸åŒ(æš‚æ— ç¡®å®šçš„çœŸç†)ï¼Œæœ€åˆé€‚çš„ï¼Ÿ',
                                options: [
                                    { text: 'åšæŒè‡ªå·±çš„æƒ³æ³•', answer: false },
                                    { text: 'å°Šé‡ä»–äººæ„è§ï¼Œå¯»æ‰¾å…±è¯†', answer: true },
                                    { text: 'æ‰“ç ´ç ‚é”…é—®åˆ°åº•', answer: false },
                                    { text: 'æ”¾å¼ƒè‡ªå·±çš„æƒ³æ³•', answer: false }
                                ]
                            },
                            {
                                id: 'q7',
                                text: 'ä½ å¯ä»¥éšæ„æ‰¾ç¾¤å‹ç´¢å–è´¢ç‰©å—ï¼Ÿ',
                                options: [
                                    { text: 'ç–¯ç‹‚æ˜ŸæœŸå››çš„æ¢—å¯ä»¥ç©ï¼Œä½†åˆ«çœŸè¦', answer: false },
                                    { text: 'è¦ç‚¹å°é’±æ— æ‰€è°“', answer: false },
                                    { text: 'ä¸èƒ½ï¼Œå¤§å®¶çš„é’±éƒ½ä¸æ˜¯é£åˆ®æ¥çš„', answer: true },
                                    { text: 'å¯ä»¥ï¼Œæˆ‘åªæ˜¯æƒ³ä¹è®¨', answer: false }
                                ]
                            },
                            {
                                id: 'q8',
                                text: 'æ‰¾åˆ«äººæ±‚åŠ©å‰"æœ€"é¦–å…ˆçš„äº‹åº”å½“ï¼Ÿ',
                                options: [
                                    { text: 'è‡ªå·±å°è¯•è§£å†³', answer: true },
                                    { text: 'æ‰“é’±', answer: true },
                                    { text: 'ç–¯ç‹‚åˆ·å±æ±‚åŠ©', answer: false },
                                    { text: 'é—®ç‚¹æ— äººçŸ¥é“çš„é—®é¢˜', answer: false }
                                ]
                            }
                        ]
                    },
                    {
                        name: 'å­¦å†',
                        description: 'æœ¬å…³è€ƒéªŒä½ çš„å­¦ç§‘çŸ¥è¯†',
                        questions: [
                            {
                                id: 'q9',
                                text: 'é€‰å‡º(a+b)(b+c)çš„å±•å¼€å¼',
                                options: [
                                    { text: 'aÂ²+ab+bÂ²+bc+cÂ²+ac', answer: false },
                                    { text: 'ab+bÂ²+bc+ac', answer: true },
                                    { text: 'aÂ²+ab+ac+bÂ²+2bc+cÂ²', answer: false },
                                    { text: 'ab+ac+bÂ²+cÂ²', answer: false }
                                ]
                            },
                            {
                                id: 'q10',
                                text: '3çš„-1æ¬¡æ–¹ç­‰äºä»€ä¹ˆï¼Ÿ',
                                options: [
                                    { text: '-3', answer: false },
                                    { text: '1/3', answer: true },
                                    { text: '0', answer: false },
                                    { text: '3', answer: false }
                                ]
                            },
                            {
                                id: 'q11',
                                text: 'æµ®åŠ›å’Œä»€ä¹ˆç›´æ¥ç›¸å…³ï¼Ÿ',
                                options: [
                                    { text: 'ç‰©ä½“çš„å¯†åº¦', answer: false },
                                    { text: 'æ¶²ä½“çš„å¯†åº¦å’Œç‰©ä½“æ’å¼€æ¶²ä½“çš„ä½“ç§¯', answer: true },
                                    { text: 'ç‰©ä½“çš„é‡é‡', answer: false },
                                    { text: 'æ¶²ä½“çš„æ·±åº¦', answer: false }
                                ]
                            },
                            {
                                id: 'q12',
                                text: 'Î”(delta)ä»£è¡¨ä»€ä¹ˆï¼Ÿ',
                                options: [
                                    { text: 'åœ†å‘¨ç‡', answer: false },
                                    { text: 'å˜åŒ–é‡æˆ–åˆ¤åˆ«å¼', answer: true },
                                    { text: 'ç§¯åˆ†', answer: false },
                                    { text: 'æ±‚å’Œ', answer: false }
                                ]
                            },
                            {
                                id: 'q13',
                                text: 'Hâ‚‚Oæ˜¯ä»€ä¹ˆç‰©è´¨ï¼Ÿ',
                                options: [
                                    { text: 'è¿‡æ°§åŒ–æ°¢', answer: false },
                                    { text: 'æ°´', answer: true },
                                    { text: 'æ°§æ°”', answer: false },
                                    { text: 'åŒæ°§æ°´', answer: false }
                                ]
                            }
                        ]
                    },
                    {
                        name: 'å¸¸è¯†',
                        description: 'æœ¬å…³è€ƒéªŒä½ çš„ç”Ÿæ´»å¸¸è¯†å’Œç½‘ç»œæ–‡åŒ–çŸ¥è¯†',
                        questions: [
                            {
                                id: 'q14',
                                text: 'é€‰æ‹©ä¸å±äºå‹ç¼©æ–‡ä»¶çš„åç¼€',
                                options: [
                                    { text: '.zip', answer: false },
                                    { text: '.rar', answer: false },
                                    { text: '.docx', answer: true },
                                    { text: '.7z', answer: false }
                                ]
                            },
                            {
                                id: 'q15',
                                text: 'é€‰æ‹©ä¸æ˜¯å‹ç¼©å·¥å…·çš„ä¸€é¡¹',
                                options: [
                                    { text: 'WinRAR', answer: false },
                                    { text: '7-Zip', answer: false },
                                    { text: 'VLC', answer: true },
                                    { text: 'WinZip', answer: false }
                                ]
                            },
                            {
                                id: 'q16',
                                text: 'ç§å­æ–‡ä»¶å¯ä»¥ç”¨ä»€ä¹ˆæ‰“å¼€ï¼Ÿ',
                                options: [
                                    { text: 'è¿…é›·', answer: true },
                                    { text: 'è®°äº‹æœ¬', answer: false },
                                    { text: 'æµè§ˆå™¨', answer: false },
                                    { text: 'è®¡ç®—å™¨', answer: false }
                                ]
                            },
                            {
                                id: 'q17',
                                text: 'Steamæ˜¯ä»€ä¹ˆï¼Ÿ',
                                options: [
                                    { text: 'è’¸æ±½', answer: false },
                                    { text: 'æ¸¸æˆå¹³å°', answer: true },
                                    { text: 'ç§‘å­¦è®¡ç®—å™¨', answer: false },
                                    { text: 'èŠå¤©è½¯ä»¶', answer: false }
                                ]
                            },
                            {
                                id: 'q18',
                                text: 'ç”¨å…½éŸ³è¯‘è€…ç¿»è¯‘"~å‘œå—·å—·å—·å—·å‘œå‘œå‘œå—·~å‘œå—·å‘œå‘œå•Šå‘œ~å•Šå•Šå—·å•Šå‘œ~å‘œ~å‘œ~å—·~å‘œå—·å‘œå—·å—·å•Š"å¾—åˆ°çš„æ•°å­—æ˜¯ï¼Ÿ',
                                options: [
                                    { text: '0721', answer: true },
                                    { text: '1234', answer: false },
                                    { text: '5678', answer: false },
                                    { text: '9012', answer: false }
                                ]
                            }
                        ]
                    }
                ];
                this.answers = {};
                this.checkPassed();
            }

            checkPassed() {
                // æ£€æŸ¥æ˜¯å¦å·²é€šè¿‡
                const passed = CookieManager.get('quiz-passed');
                if (passed === 'true') {
                    document.getElementById('quiz-start').style.display = 'none';
                    document.getElementById('quiz-content').style.display = 'block';
                    document.getElementById('result').style.display = 'block';
                    
                    const resultTitle = document.getElementById('result-title');
                    const resultMessage = document.getElementById('result-message');
                    const nextBtn = document.getElementById('next-to-groups-btn');
                    
                    resultTitle.textContent = 'ğŸ‰ å·²é€šè¿‡éªŒè¯';
                    resultMessage.textContent = `ä½ å·²ç»é€šè¿‡äº†æ‰€æœ‰å…³å¡ï¼\nå¯ä»¥å†æ¬¡æŒ‘æˆ˜æ¥å›å‘³é¢˜ç›®ï¼Œæˆ–ç‚¹å‡»ä¸‹ä¸€æ­¥è¿›å…¥ç¾¤èŠåˆ—è¡¨`;
                    resultTitle.style.color = '#28a745';
                    nextBtn.style.display = 'block';
                    const retryBtn = document.getElementById('retry-btn');
                    if (retryBtn) retryBtn.style.display = 'block';
                }
            }

            init() {
                document.getElementById('start-btn').addEventListener('click', () => this.startQuiz());
                document.getElementById('prev-stage-btn').addEventListener('click', () => this.prevStage());
                document.getElementById('next-stage-btn').addEventListener('click', () => this.nextStage());
                document.getElementById('next-to-groups-btn').addEventListener('click', () => this.showGroupsList());
                document.getElementById('quiz-form').addEventListener('submit', (e) => this.submitStage(e));
                
                // ç¾¤å¡äº‹ä»¶ç›‘å¬
                const groupCard = document.querySelector('.group-card');
                if (groupCard) {
                    groupCard.addEventListener('click', () => this.selectGroup('MCD'));
                }
                
                const confirmBtn = document.getElementById('confirm-rules-btn');
                if (confirmBtn) {
                    confirmBtn.addEventListener('click', () => this.showGroupNumberModal());
                }
                
                const okBtn = document.querySelector('.btn-ok');
                if (okBtn) {
                    okBtn.addEventListener('click', () => this.closeGroupNumberModal());
                }
                
                const qqBtn = document.querySelector('.btn-qq');
                if (qqBtn) {
                    qqBtn.addEventListener('click', () => this.openQQ());
                }
                const retryBtn = document.getElementById('retry-btn');
                if (retryBtn) retryBtn.addEventListener('click', () => this.restartQuiz());
            }

            startQuiz() {
                document.getElementById('quiz-start').style.display = 'none';
                document.getElementById('quiz-content').style.display = 'block';
                this.showStage(0);
            }

            restartQuiz() {
                // æ¸…é™¤é€šè¿‡çŠ¶æ€å¹¶é‡ç½®ç­”é¢˜æ•°æ®ï¼Œå›åˆ°å¼€å§‹ç•Œé¢
                if (window.CookieManager && typeof CookieManager.remove === 'function') {
                    CookieManager.remove('quiz-passed');
                }
                this.answers = {};
                this.currentStage = 0;
                document.getElementById('result').style.display = 'none';
                document.getElementById('groups-container').style.display = 'none';
                document.getElementById('quiz-content').style.display = 'none';
                document.getElementById('stage-header').style.display = 'none';
                document.getElementById('quiz-start').style.display = 'block';
            }

            showStage(index) {
                this.currentStage = index;
                const stage = this.stages[index];
                const container = document.getElementById('questions-container');
                
                // æ˜¾ç¤ºå…³å¡æ ‡é¢˜
                document.getElementById('stage-header').innerHTML = `
                    <div class="stage-title">ç¬¬ ${index + 1} å…³ï¼š${stage.name}</div>
                    <div class="stage-description">${stage.description}</div>
                `;
                
                // éšè—é”™è¯¯æ¶ˆæ¯
                document.getElementById('error-message').style.display = 'none';
                
                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';
                
                // ç”Ÿæˆé¢˜ç›®
                stage.questions.forEach((q, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-group';
                    questionDiv.id = q.id;
                    
                    const shuffledOptions = shuffleArray(q.options);
                    const letters = ['A', 'B', 'C', 'D'];
                    
                    let optionsHTML = shuffledOptions.map((option, idx) => {
                        return `<label class="option-label"><input type="radio" name="${q.id}" value="${letters[idx]}" data-answer="${option.answer}"> ${letters[idx]}. ${option.text}</label>`;
                    }).join('');
                    
                    questionDiv.innerHTML = `
                        <div class="question">
                            <p><strong>ç¬¬${qIndex + 1}é¢˜ï¼š</strong>${q.text}</p>
                            <div class="options">
                                ${optionsHTML}
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(questionDiv);
                    
                    // æ¢å¤å·²ä¿å­˜çš„ç­”æ¡ˆ
                    const savedAnswer = this.answers[q.id];
                    if (savedAnswer) {
                        document.querySelector(`input[name="${q.id}"][value="${savedAnswer}"]`).checked = true;
                    }
                });
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const prevBtn = document.getElementById('prev-stage-btn');
                const nextBtn = document.getElementById('next-stage-btn');
                const submitBtn = document.getElementById('submit-btn');
                
                prevBtn.style.display = index > 0 ? 'block' : 'none';
                nextBtn.style.display = index < this.stages.length - 1 ? 'block' : 'none';
                submitBtn.style.display = index === this.stages.length - 1 ? 'block' : 'none';
            }

            validateStage(stageIndex) {
                const stage = this.stages[stageIndex];
                let allCorrect = true;
                const errorQuestions = [];
                
                stage.questions.forEach(q => {
                    const selectedRadio = document.querySelector(`input[name="${q.id}"]:checked`);
                    
                    if (!selectedRadio) {
                        allCorrect = false;
                        this.highlightQuestion(q.id, false);
                        errorQuestions.push(`ç¬¬${stage.questions.indexOf(q) + 1}é¢˜`);
                    } else {
                        const isCorrect = selectedRadio.dataset.answer === 'true';
                        if (isCorrect) {
                            this.answers[q.id] = selectedRadio.value;
                            this.highlightQuestion(q.id, true);
                        } else {
                            allCorrect = false;
                            this.highlightQuestion(q.id, false);
                            errorQuestions.push(`ç¬¬${stage.questions.indexOf(q) + 1}é¢˜`);
                        }
                    }
                });
                
                if (!allCorrect) {
                    const errorMsg = document.getElementById('error-message');
                    errorMsg.textContent = `${stage.name}å…³æœ‰è¯¯ï¼š${errorQuestions.join('ã€')}`;
                    errorMsg.style.display = 'block';
                    
                    // æ™ºåŠ›å…³æœ‰é”™æ˜¾ç¤ºéäººç±»
                    if (stageIndex === 0) {
                        const nonHuman = document.createElement('div');
                        nonHuman.className = 'non-human-message';
                        nonHuman.textContent = 'éäººç±»';
                        document.body.appendChild(nonHuman);
                        setTimeout(() => nonHuman.remove(), 2000);
                    }
                } else {
                    // é€šè¿‡è¯¥å…³ï¼Œæ˜¾ç¤ºè°ƒä¾ƒæç¤ºæ¡†ï¼ˆæ ¹æ®ä¸åŒå…³å¡æ˜¾ç¤ºä¸åŒå†…å®¹ï¼‰
                    let taunt = '';
                    if (stageIndex === 0) {
                        taunt = 'å¤ªå¥½äº†ï¼Œæ˜¯äººç±»ï¼';
                    } else if (stageIndex === 1) {
                        taunt = 'å—¯...å¸Œæœ›å¤§ä¼™åˆå¾—æ¥';
                    } else if (stageIndex === 2) {
                        taunt = 'è€ƒçš„ä¸æ˜¯å­¦å†è€Œæ˜¯é˜…å†ï¼';
                    } else if (stageIndex === 3) {
                        taunt = 'å¸Œæœ›ä½ åˆ«é—®äº›æ­£å¸¸äººçŸ¥é“çš„';
                    }
                    setTimeout(() => showWindowsNotification({title: 'ä½ è¿‡å…³ï¼', content: taunt, duration: 3000}), 300);
                }
                
                return allCorrect;
            }

            highlightQuestion(questionId, isCorrect) {
                const questionDiv = document.getElementById(questionId);
                if (isCorrect) {
                    questionDiv.classList.add('correct');
                    questionDiv.classList.remove('incorrect');
                } else {
                    questionDiv.classList.add('incorrect');
                    questionDiv.classList.remove('correct');
                }
            }

            prevStage() {
                if (this.currentStage > 0) {
                    this.showStage(this.currentStage - 1);
                }
            }

            nextStage() {
                if (this.validateStage(this.currentStage)) {
                    if (this.currentStage < this.stages.length - 1) {
                        this.showStage(this.currentStage + 1);
                    } else {
                        this.completeQuiz();
                    }
                }
            }

            submitStage(e) {
                e.preventDefault();
                
                if (this.validateStage(this.currentStage)) {
                    this.completeQuiz();
                }
            }

            completeQuiz() {
                // ä¿å­˜é€šè¿‡çŠ¶æ€åˆ°cookieï¼ˆ30å¤©ï¼‰
                CookieManager.set('quiz-passed', 'true', 30);
                
                // æ˜¾ç¤ºæˆåŠŸæç¤ºæ¡†
                const totalQuestions = this.stages.reduce((sum, stage) => sum + stage.questions.length, 0);
                showWindowsNotification({
                    title: 'ğŸ‰ æ­å–œ',
                    content: `ä½ å·²å®Œç¾é€šè¿‡æ‰€æœ‰å››å¤§å…³ï¼\nå…±ç­”å¯¹ ${totalQuestions} / ${totalQuestions} é¢˜\næ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„ç¾¤èŠï¼`,
                    duration: 4000
                });
                
                document.getElementById('quiz-form').style.display = 'none';
                document.getElementById('stage-header').style.display = 'none';
                document.getElementById('result').style.display = 'block';
                
                const resultTitle = document.getElementById('result-title');
                const resultMessage = document.getElementById('result-message');
                const nextBtn = document.getElementById('next-to-groups-btn');
                
                resultTitle.textContent = 'ğŸ‰ æ­å–œï¼';
                resultMessage.textContent = `ä½ å·²å®Œç¾é€šè¿‡æ‰€æœ‰å››å¤§å…³ï¼\nå…±ç­”å¯¹ ${totalQuestions} / ${totalQuestions} é¢˜\næ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„ç¾¤èŠï¼`;
                resultTitle.style.color = '#28a745';
                nextBtn.style.display = 'block';
                const retryBtn = document.getElementById('retry-btn');
                if (retryBtn) retryBtn.style.display = 'block';
            }

            showGroupsList() {
                document.getElementById('result').style.display = 'none';
                document.getElementById('groups-container').style.display = 'block';
            }

            selectGroup(groupName) {
                if (groupName === 'MCD') {
                    this.showGroupRulesModal();
                }
            }

            showGroupRulesModal() {
                const modal = document.getElementById('group-rules-modal');
                const confirmBtn = document.getElementById('confirm-rules-btn');
                const countdown = document.getElementById('rules-countdown');
                
                let seconds = 3;
                modal.style.display = 'flex';
                countdown.textContent = `(${seconds}ç§’åå¯ç‚¹å‡»)`;
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.5';
                confirmBtn.style.cursor = 'not-allowed';
                
                const timer = setInterval(() => {
                    seconds--;
                    if (seconds > 0) {
                        countdown.textContent = `(${seconds}ç§’åå¯ç‚¹å‡»)`;
                    } else {
                        countdown.textContent = '';
                        confirmBtn.disabled = false;
                        confirmBtn.style.opacity = '1';
                        confirmBtn.style.cursor = 'pointer';
                        clearInterval(timer);
                    }
                }, 1000);
            }

            showGroupNumberModal() {
                document.getElementById('group-rules-modal').style.display = 'none';
                document.getElementById('group-number-modal').style.display = 'flex';
            }

            closeGroupNumberModal() {
                document.getElementById('group-number-modal').style.display = 'none';
            }

            openQQ() {
                // ä½¿ç”¨QQç¾¤åŠ ç¾¤é“¾æ¥
                const qqGroupUrl = 'https://qm.qq.com/cgi-bin/qm/qr?k=u9caISjpLIET6YaOKZT82vkZW-g-O-Fk&jump_from=webapi&authKey=oNZno4AoQvD81o5xqzxE52MRKNbMdn++H4k6z42Juy8TR/Dwb3ydPDRuRIxSwwmL';
                window.location.href = qqGroupUrl;
            }
        }

        window.quizManager = null;

        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿ä¸»é¢˜ç®¡ç†å™¨å·²åˆå§‹åŒ–
            if (window.ThemeManager) {
                ThemeManager.init();
            }
            
            window.quizManager = new QuizManager();
            window.quizManager.init();
        });
    </script>
</body>
</html>
